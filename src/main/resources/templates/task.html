<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Falsi Home</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>

    <link th:href="@{/style/comment.css}" rel="stylesheet" />

    <style>
        .checkbox-xl .form-check-input {
            top: 1.2rem;
            scale: 2.5;
            margin-left: 1%;
        }
    </style>

    <script>
        function init() {
            let deadlineDate = document.getElementById("deadlineDate");
            deadlineDate.min = getTomorrow();
            deadlineDate.value = deadlineDate.min;

            checkDeadline();
        }

        function getTomorrow() {
            let date = new Date();
            date.setDate(date.getDate() + 1);
            return date.toISOString().slice(0, 10);;
        }

        function checkDeadline() {
            let deadlineS = document.getElementById("deadlineDate").innerHTML;
            let today = new Date();
            let deadline = moment(deadlineS, "DD-MM-YYYY").toDate();

            let dif = (deadline - today);
            document.getElementById("deadlineDaysLeft").innerHTML =  '(Left: ' + Math.ceil(dif / (1000 * 3600 * 24)) + ' days)';
            document.getElementById("deadlineDaysLeft").style.color= dif>0 ? 'green' : 'red';
        }

    </script>
</head>

<body onload="init();">

    <div th:replace="fragments/topnav :: navbar" />

    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <div class="card" style="margin-top:2%">
                <div class="card-header">
                    <h3>Task number: <span th:text="${task.number}"></span></h3>
                </div>
                <div class="card-body">

                    <!--Task Priotity -->
                    <div class="form-group row">
                        <div class="col-sm-2">
                            <label for="priority" class="col-form-label"
                                style="text-align:center;font-size:18px;border-style: groove;width:100%">Priority</label>
                        </div>
                        <div class="col-sm-10">
                            <h3 id="priority" th:text="${task.priority.name}" style="height:100%;width:100%"></h3>
                        </div>
                    </div>

                    <!--Task Type -->
                    <div class="form-group row">
                        <div class="col-sm-2">
                            <label for="type" class="col-form-label"
                                style="text-align:center;font-size:18px;border-style: groove;width:100%">Type</label>
                        </div>
                        <div class="col-sm-10">
                            <h3 id="type" th:text="${task.taskType.name}" style="height:100%;width:100%"></h3>
                        </div>
                    </div>

                    <!--Task Creation date -->
                    <div class="form-group row">
                        <div class="col-sm-2">
                            <label for="creationDate" class="col-form-label"
                                style="text-align:center;font-size:18px;border-style: groove;width:100%">Creation
                                date</label>
                        </div>
                        <div class="col-sm-10">
                            <h3 id="creationDate" th:text="${#temporals.format(task.creationDate, 'dd-MM-yyyy')}"
                                style="height:100%;width:100%"></h3>
                        </div>
                    </div>

                    <!--Task Deadline date -->
                    <div class="form-group row">
                        <div class="col-sm-2">
                            <label for="deadlineDate" class="col-form-label"
                                style="text-align:center;font-size:18px;border-style: groove;width:100%">Deadline
                                date</label>
                        </div>
                        <div class="col-sm-10">
                            <div class="row">
                                    <h3 id="deadlineDate" th:text="${#temporals.format(task.deadlineDate, 'dd-MM-yyyy')}"
                                    style="height:100%"></h3>

                                    <h3 id="deadlineDaysLeft" style="margin-left: 1%;text-align: left;"></h3>
                            </div>
                        </div>
                    </div>

                </div>

                <form th:action="@{'/falsi/task/' + ${task.number} + '/message'}" th:object="${message}" method="post">
                    <div class="form-group row">
                        <div class="col-md-12" style="text-align:center">
                            <textarea required id="description" th:field="*{text}" rows="5" cols="2"
                                style="width:90%;margin-left:auto;margin-right:auto"></textarea>
                            <button class="btn btn-primary" type="submit"
                                style="width:90%;margin-left:auto;margin-right:auto">
                                Send
                            </button>
                        </div>
                    </div>
                </form>

                <div th:each="comment: ${task.messages} " class="col-md-12"
                    style="text-align:center;margin-bottom:2%;display:block">
                    <div class="bg-white p-2">
                        <div class="d-flex flex-row user-info">
                            <i style="font-size:60px;text-align:left" class="bi bi-person-square"></i>
                            <div class="d-flex flex-column justify-content-start ml-2" style="margin-top:1%">
                                <span style="text-align:left;font-size:25px;" class="d-block font-weight-bold name"
                                    th:text="${comment.userName}">
                                </span>
                                <span style="margin-top:2%;font-size:20px;" class="date text-black-50"
                                    th:text="${#temporals.format(comment.dateTime, 'dd-MM-yyyy HH:mm')}"></span>
                            </div>
                        </div>
                        <div style="text-align:left" class="mt-2">
                            <p style="text-align:left;font-size:25px;" class="comment-text"
                                th:text="${comment.message}"></p>
                        </div>
                    </div>
                    <hr>
                </div>
            </div>
        </div>
        <div class="col-md-2"></div>
    </div>

</body>

</html>